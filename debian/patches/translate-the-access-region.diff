commit c77ba9f217093f946a4c6bf6edf9f34b24844d8d
Author: SÃ¸ren Sandmann <ssp@redhat.com>
Date:   Fri Oct 28 12:56:30 2011 -0400

    Translate the access region according to the drawable offset.
    
    The driver code expects to be given coordinates relative to the
    offscreen pixmap.

diff --git a/src/uxa/uxa.c b/src/uxa/uxa.c
index 83e06cc..9d02e34 100644
--- a/src/uxa/uxa.c
+++ b/src/uxa/uxa.c
@@ -143,19 +143,19 @@ Bool uxa_prepare_access(DrawablePtr pDrawable, RegionPtr region, uxa_access_t ac
 {
 	ScreenPtr pScreen = pDrawable->pScreen;
 	uxa_screen_t *uxa_screen = uxa_get_screen(pScreen);
-	PixmapPtr pPixmap = uxa_get_drawable_pixmap(pDrawable);
-	Bool offscreen = uxa_pixmap_is_offscreen(pPixmap);
+	int xoff, yoff;
+	PixmapPtr pPixmap = uxa_get_offscreen_pixmap(pDrawable, &xoff, &yoff);
 	BoxRec box;
 	RegionRec region_rec;
 	Bool result;
 
-	if (!offscreen)
+	if (!pPixmap)
 	    return TRUE;
 
 	box.x1 = 0;
 	box.y1 = 0;
-	box.x2 = pPixmap->drawable.width;
-	box.y2 = pPixmap->drawable.height;
+	box.x2 = pDrawable->width;
+	box.y2 = pDrawable->height;
 	
 	REGION_INIT (pScreen, &region_rec, &box, 1);
 	if (!region)
@@ -168,7 +168,8 @@ Bool uxa_prepare_access(DrawablePtr pDrawable, RegionPtr region, uxa_access_t ac
 	 */
 	REGION_INTERSECT (pScreen, region, region, &region_rec);
 #endif
-	
+	REGION_TRANSLATE (pScreen, region, xoff, yoff);
+
 	result = TRUE;
 
 	if (uxa_screen->info->prepare_access)
